{% extends 'base_admin.html' %} {% block title %} Dataset {% endblock %} {%
block content %}

<h3 class="mb-5">Import Data Penjualan</h3>

<div class="card">
  <div class="card-body">
    <h5>Ketentuan</h5>
    <ul>
      <li>- Data merupakan laporan transaksi penjualan</li>
      <li>
        - Tidak masalah jika transaksi yang sama sudah pernah diimport
        sebelumnya
      </li>
      <li>- Format file <b>.xls</b> atau <b>.xlsx</b></li>
      <li>
        - Nama kolom yaitu
        <b>No. Faktur, Tanggal Transaksi, Kode Barang,</b>dan
        <b>Nama Barang</b>
      </li>
    </ul>
    <img
      src="/static/images/dataset/sales-data-rules.png"
      height="200"
      alt=""
    />
  </div>
</div>

<div class="card">
  <div class="card-body">
    <!-- {% with messages = get_flashed_messages() %} {% if messages %}
    <div class="alert alert-success" role="alert">{{ messages[0] }}</div>
    {% endif %} {% endwith %} -->

    {% with messages = get_flashed_messages() %} {% if messages %} {% if
    messages[0] == 'Data transaksi penjualan berhasil diimport.' %}
    <div class="alert alert-success" role="alert">{{ messages[0] }}</div>
    {% else %}
    <div class="alert alert-warning" role="alert">{{ messages[0] }}</div>
    {% endif %} {% endif %} {% endwith %}

    <h5>Formulir</h5>

    <form action="" method="post" enctype="multipart/form-data">
      <p>
        <input type="file" name="file" /><input
          type="submit"
          value="Upload"
          class="btn btn-primary"
        />
      </p>
    </form>
  </div>
</div>

{% if dataframe_html %}
<div class="card" id="card-dataframe">
  <div class="card-body">
    <h5 class="mb-3">Data Diimport</h5>
    {{ dataframe_html | safe }}
  </div>
</div>
{% endif %}

<style>
  th {
    text-align: center;
  }
</style>

{% endblock %} {% block scripts %}
<script>
  document.querySelector("form").addEventListener("submit", function () {
    // Show the loading animation
    const timerInterval = 0; // Deklarasikan di sini untuk mengaksesnya secara global

    Swal.fire({
      title: "Mengimport Data",
      html: "Silahkan tunggu! Memerlukan waktu beberapa saat",
      timerProgressBar: true,
      showConfirmButton: false,
      allowOutsideClick: false,
      timer: 0,
      didOpen: () => {
        Swal.showLoading();

        // Function to check for the presence of the "card-dataframe" element
        function checkCardDataframe() {
          const cardDataframeElement =
            document.getElementById("card-dataframe");
          if (cardDataframeElement) {
            // Hide the loading animation
            Swal.close();
            clearInterval(timerInterval); // Clear the timer interval when the card-dataframe element appears
          } else {
            // Continue checking until "card-dataframe" element appears
            setTimeout(checkCardDataframe, 500); // Check every 500 milliseconds
          }
        }

        // Start checking for the "card-dataframe" element
        checkCardDataframe();
      },
    });
  });
</script>
{% endblock %}
